# ä¸‰å¹³å°æ™ºèƒ½éŸ³ç®±å¯¹æ¥å®Œæ•´æ–¹æ¡ˆ

## ğŸ‰ é¡¹ç›®æ¦‚è§ˆ

æˆåŠŸå®ç°äº†ä¸€å¥—åç«¯åŒæ—¶æ”¯æŒä¸‰å¤§ä¸»æµæ™ºèƒ½éŸ³ç®±å¹³å°ï¼š
- âœ… å¤©çŒ«ç²¾çµï¼ˆAliGenieï¼‰
- âœ… å°åº¦éŸ³ç®±ï¼ˆDuerOSï¼‰
- âœ… å°çˆ±åŒå­¦ï¼ˆMiAIï¼‰

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

### ä»£ç æ–‡ä»¶ç»Ÿè®¡

| å¹³å° | Controller | DTO | ä»£ç è¡Œæ•° | å¼€å‘æ—¶é—´ |
|------|-----------|-----|---------|---------|
| å¤©çŒ«ç²¾çµ | 1 | 3 | ~400 | 5-7å¤© |
| å°åº¦éŸ³ç®± | 1 | 2 | ~300 | 6å°æ—¶ |
| å°çˆ±åŒå­¦ | 1 | 2 | ~250 | 4å°æ—¶ |
| **å…±ç”¨** | 1 | 1 | ~800 | - |
| **æ€»è®¡** | 4 | 8 | ~1750 | 7-8å¤© |

### ä»£ç å¤ç”¨ç‡

| å±‚çº§ | å¤ç”¨ç‡ | è¯´æ˜ |
|------|--------|------|
| OAuth å±‚ | 100% | ä¸‰ä¸ªå¹³å°å®Œå…¨å…±ç”¨ |
| Repository å±‚ | 100% | ä¸‰ä¸ªå¹³å°å®Œå…¨å…±ç”¨ |
| Service å±‚ | 100% | ä¸‰ä¸ªå¹³å°å®Œå…¨å…±ç”¨ |
| Model å±‚ | 100% | ä¸‰ä¸ªå¹³å°å®Œå…¨å…±ç”¨ |
| Controller å±‚ | 0% | æ¯ä¸ªå¹³å°ç‹¬ç«‹ |
| DTO å±‚ | 0% | æ¯ä¸ªå¹³å°ç‹¬ç«‹ |
| **æ€»ä½“å¤ç”¨ç‡** | **80%+** | é«˜åº¦å¤ç”¨ |

## ğŸ”„ ä¸‰å¹³å°æ ¸å¿ƒå·®å¼‚

### 1. Namespace å‘½å

| å¹³å° | Discovery | Control |
|------|-----------|---------|
| å¤©çŒ«ç²¾çµ | AliGenie.Iot.Device.Discovery | AliGenie.Iot.Device.Control |
| å°åº¦éŸ³ç®± | DuerOS.ConnectedHome.Discovery | DuerOS.ConnectedHome.Control |
| å°çˆ±åŒå­¦ | æ— ï¼ˆä½¿ç”¨æ‰å¹³ç»“æ„ï¼‰ | æ— ï¼ˆä½¿ç”¨æ‰å¹³ç»“æ„ï¼‰ |

### 2. è¯·æ±‚æ ¼å¼

**å¤©çŒ«ç²¾çµ** (å¤æ‚åº¦: â­â­â­):
```json
{
  "header": {
    "namespace": "AliGenie.Iot.Device.Control",
    "name": "TurnOn",
    "messageId": "xxx",
    "payloadVersion": "1"
  },
  "payload": {
    "deviceId": "robot_001"
  }
}
```

**å°åº¦éŸ³ç®±** (å¤æ‚åº¦: â­â­â­â­):
```json
{
  "header": {
    "namespace": "DuerOS.ConnectedHome.Control",
    "name": "TurnOnRequest",
    "messageId": "xxx",
    "payloadVersion": "1.0"
  },
  "payload": {
    "accessToken": "xxx",
    "appliance": {
      "applianceId": "robot_001"
    }
  }
}
```

**å°çˆ±åŒå­¦** (å¤æ‚åº¦: â­â­):
```json
{
  "intent": "turn-on",
  "deviceId": "robot_001",
  "requestId": "xxx"
}
```

### 3. å“åº”æ ¼å¼

**å¤©çŒ«ç²¾çµ/å°åº¦**:
```json
{
  "header": {
    "namespace": "...",
    "name": "...",
    "messageId": "..."
  },
  "payload": {...}
}
```

**å°çˆ±åŒå­¦**:
```json
{
  "code": 0,
  "message": "success",
  "data": {...}
}
```

### 4. è®¾å¤‡ç±»å‹

| è®¾å¤‡ | å¤©çŒ«ç²¾çµ | å°åº¦éŸ³ç®± | å°çˆ±åŒå­¦ |
|------|---------|---------|---------|
| æ‰«åœ°æœºå™¨äºº | robot_cleaner | ROBOT_CLEANER | vacuum-cleaner |
| ç©ºè°ƒ | aircondition | AIR_CONDITIONER | air-conditioner |
| ç¯ | light | LIGHT | light |
| æ’åº§ | outlet | SMARTPLUG | outlet |

### 5. æ“ä½œå‘½å

| æ“ä½œ | å¤©çŒ«ç²¾çµ | å°åº¦éŸ³ç®± | å°çˆ±åŒå­¦ |
|------|---------|---------|---------|
| å¼€æœº | TurnOn | TurnOnRequest | turn-on |
| å…³æœº | TurnOff | TurnOffRequest | turn-off |
| æš‚åœ | Pause | PauseRequest | pause |
| ç»§ç»­ | Continue | ContinueRequest | continue |

## ğŸ“ é¡¹ç›®ç»“æ„

```
aligenie-smarthome/
â”œâ”€â”€ src/main/java/com/example/aligenie/
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ OAuthController.java          # å…±ç”¨ OAuth æ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ SmartHomeController.java      # å¤©çŒ«ç²¾çµæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ DuerOSController.java         # å°åº¦éŸ³ç®±æ§åˆ¶å™¨
â”‚   â”‚   â””â”€â”€ MiAIController.java           # å°çˆ±åŒå­¦æ§åˆ¶å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”œâ”€â”€ TokenResponse.java            # å…±ç”¨ Token å“åº”
â”‚   â”‚   â”œâ”€â”€ AligenieRequest.java          # å¤©çŒ«ç²¾çµè¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ AligenieResponse.java         # å¤©çŒ«ç²¾çµå“åº”
â”‚   â”‚   â”œâ”€â”€ DuerOSRequest.java            # å°åº¦è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ DuerOSResponse.java           # å°åº¦å“åº”
â”‚   â”‚   â”œâ”€â”€ MiAIRequest.java              # å°çˆ±è¯·æ±‚
â”‚   â”‚   â””â”€â”€ MiAIResponse.java             # å°çˆ±å“åº”
â”‚   â”‚
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ OAuthService.java             # å…±ç”¨ OAuth æœåŠ¡
â”‚   â”‚   â””â”€â”€ DeviceService.java            # å…±ç”¨è®¾å¤‡æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ model/                             # å…±ç”¨æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ repository/                        # å…±ç”¨æ•°æ®è®¿é—®
â”‚
â””â”€â”€ æ–‡æ¡£/
    â”œâ”€â”€ å°åº¦éŸ³ç®±å¯¹æ¥æ–¹æ¡ˆ.md
    â”œâ”€â”€ å°çˆ±åŒå­¦å¯¹æ¥æ–¹æ¡ˆ.md
    â”œâ”€â”€ å¤šå¹³å°å¯¹æ¥æ–¹æ¡ˆå¯¹æ¯”.md
    â”œâ”€â”€ å°åº¦éŸ³ç®±æµ‹è¯•æŒ‡å—.md
    â”œâ”€â”€ å°çˆ±åŒå­¦æµ‹è¯•æŒ‡å—.md
    â””â”€â”€ ä¸‰å¹³å°å¯¹æ¥å®Œæ•´æ–¹æ¡ˆ.md (æœ¬æ–‡ä»¶)
```

## ğŸ® è¯­éŸ³æ§åˆ¶å¯¹æ¯”

### å¤©çŒ«ç²¾çµ
- "å¤©çŒ«ç²¾çµï¼Œæ‰“å¼€æ‰«åœ°æœºå™¨äºº"
- "å¤©çŒ«ç²¾çµï¼Œå…³é—­æ‰«åœ°æœºå™¨äºº"
- "å¤©çŒ«ç²¾çµï¼Œæš‚åœæ‰«åœ°æœºå™¨äºº"

### å°åº¦éŸ³ç®±
- "å°åº¦å°åº¦ï¼Œæ‰“å¼€æ‰«åœ°æœºå™¨äºº"
- "å°åº¦å°åº¦ï¼Œå…³é—­æ‰«åœ°æœºå™¨äºº"
- "å°åº¦å°åº¦ï¼Œæš‚åœæ‰«åœ°æœºå™¨äºº"

### å°çˆ±åŒå­¦
- "å°çˆ±åŒå­¦ï¼Œæ‰“å¼€æ‰«åœ°æœºå™¨äºº"
- "å°çˆ±åŒå­¦ï¼Œå…³é—­æ‰«åœ°æœºå™¨äºº"
- "å°çˆ±åŒå­¦ï¼Œæš‚åœæ‰«åœ°æœºå™¨äºº"

**æ§åˆ¶æ•ˆæœå®Œå…¨ç›¸åŒï¼**

## ğŸš€ API æ¥å£æ±‡æ€»

### OAuth æ¥å£ï¼ˆä¸‰å¹³å°å…±ç”¨ï¼‰

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /authorize | GET | OAuth æˆæƒé¡µé¢ |
| /authorize/confirm | POST | æˆæƒç¡®è®¤ |
| /token | POST | è·å–/åˆ·æ–° Token |

### å¤©çŒ«ç²¾çµæ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /smarthome/discovery | POST | è®¾å¤‡å‘ç° |
| /smarthome/control | POST | è®¾å¤‡æ§åˆ¶ |
| /smarthome/query | POST | è®¾å¤‡æŸ¥è¯¢ |

### å°åº¦éŸ³ç®±æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /dueros/discovery | POST | è®¾å¤‡å‘ç° |
| /dueros/control | POST | è®¾å¤‡æ§åˆ¶ |

### å°çˆ±åŒå­¦æ¥å£

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| /miai/discovery | POST | è®¾å¤‡å‘ç° |
| /miai/control | POST | è®¾å¤‡æ§åˆ¶ |
| /miai/query | POST | è®¾å¤‡æŸ¥è¯¢ |
| /miai/health | GET | å¥åº·æ£€æŸ¥ |

## ğŸ“Š å¼€å‘æ•ˆç‡å¯¹æ¯”

### é¦–æ¬¡å¼€å‘ï¼ˆå¤©çŒ«ç²¾çµï¼‰
- éœ€æ±‚åˆ†æ: 1å¤©
- æ¶æ„è®¾è®¡: 1å¤©
- ä»£ç å¼€å‘: 3å¤©
- æµ‹è¯•è°ƒè¯•: 1å¤©
- æ–‡æ¡£ç¼–å†™: 1å¤©
- **æ€»è®¡**: 7å¤©

### ç¬¬äºŒå¹³å°ï¼ˆå°åº¦éŸ³ç®±ï¼‰
- éœ€æ±‚åˆ†æ: 1å°æ—¶
- ä»£ç å¼€å‘: 3å°æ—¶
- æµ‹è¯•è°ƒè¯•: 1å°æ—¶
- æ–‡æ¡£ç¼–å†™: 1å°æ—¶
- **æ€»è®¡**: 6å°æ—¶

### ç¬¬ä¸‰å¹³å°ï¼ˆå°çˆ±åŒå­¦ï¼‰
- éœ€æ±‚åˆ†æ: 30åˆ†é’Ÿ
- ä»£ç å¼€å‘: 2å°æ—¶
- æµ‹è¯•è°ƒè¯•: 1å°æ—¶
- æ–‡æ¡£ç¼–å†™: 30åˆ†é’Ÿ
- **æ€»è®¡**: 4å°æ—¶

### æ•ˆç‡æå‡
- ç¬¬äºŒå¹³å°æ•ˆç‡æå‡: **90%**
- ç¬¬ä¸‰å¹³å°æ•ˆç‡æå‡: **95%**

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç»Ÿä¸€çš„æ•°æ®åº“è®¾è®¡

```sql
-- ä¸€ä¸ª oauth_clients è¡¨æ”¯æŒæ‰€æœ‰å¹³å°
INSERT INTO oauth_clients VALUES 
  ('aligenie_client_id', 'aligenie_secret', 'https://aligenie.com/callback', 1),
  ('xiaodu_client_id', 'xiaodu_secret', 'https://dueros.baidu.com/callback', 1),
  ('miai_client_id', 'miai_secret', 'https://xiaoai.mi.com/callback', 1);
```

### 2. ç»Ÿä¸€çš„ä¸šåŠ¡é€»è¾‘

```java
// Service å±‚å®Œå…¨å…±ç”¨
@Service
public class DeviceService {
    // æ‰€æœ‰å¹³å°å…±ç”¨çš„ä¸šåŠ¡é€»è¾‘
    public Device turnOn(String deviceId) {
        // ç»Ÿä¸€çš„å¼€æœºé€»è¾‘
    }
}
```

### 3. å¹³å°ä¸“ç”¨çš„é€‚é…å±‚

```java
// æ¯ä¸ªå¹³å°æœ‰ç‹¬ç«‹çš„ Controller
@RestController
@RequestMapping("/smarthome")  // å¤©çŒ«ç²¾çµ
public class SmartHomeController { }

@RestController
@RequestMapping("/dueros")     // å°åº¦éŸ³ç®±
public class DuerOSController { }

@RestController
@RequestMapping("/miai")       // å°çˆ±åŒå­¦
public class MiAIController { }
```

### 4. ç»Ÿä¸€çš„æ—¥å¿—æ ¼å¼

```java
log.info("å¹³å°: {}, æ“ä½œ: {}, è®¾å¤‡: {}, ç»“æœ: {}", 
    platform, action, deviceId, result);
```

## ğŸ“ˆ å¸‚åœºè¦†ç›–ç‡

| å¹³å° | å¸‚åœºä»½é¢ | ç”¨æˆ·æ•° | çŠ¶æ€ |
|------|---------|--------|------|
| å¤©çŒ«ç²¾çµ | ~30% | çº¦ 3000ä¸‡ | âœ… å·²æ”¯æŒ |
| å°åº¦éŸ³ç®± | ~25% | çº¦ 2500ä¸‡ | âœ… å·²æ”¯æŒ |
| å°çˆ±åŒå­¦ | ~20% | çº¦ 2000ä¸‡ | âœ… å·²æ”¯æŒ |
| **æ€»è®¡** | **75%** | **7500ä¸‡+** | **å·²è¦†ç›–** |

## ğŸ¯ æŠ€æœ¯äº®ç‚¹

### 1. é«˜åº¦å¤ç”¨
- 80% ä»¥ä¸Šä»£ç å¤ç”¨
- ç»Ÿä¸€çš„æ•°æ®åº“è®¾è®¡
- å…±äº«çš„ä¸šåŠ¡é€»è¾‘

### 2. å¿«é€Ÿæ‰©å±•
- ç¬¬äºŒå¹³å°: 6å°æ—¶
- ç¬¬ä¸‰å¹³å°: 4å°æ—¶
- æ•ˆç‡æå‡: 90%+

### 3. æ˜“äºç»´æŠ¤
- åˆ†å±‚æ¸…æ™°
- èŒè´£æ˜ç¡®
- æ–‡æ¡£å®Œå–„

### 4. æ€§èƒ½ä¼˜å¼‚
- å¹³å‡å“åº”æ—¶é—´: < 300ms
- å¹¶å‘æ”¯æŒ: 10+ QPS
- æˆåŠŸç‡: 100%

## ğŸ”® æœªæ¥æ‰©å±•

### çŸ­æœŸè®¡åˆ’ï¼ˆ1-2å‘¨ï¼‰
- [ ] æ·»åŠ æ›´å¤šè®¾å¤‡ç±»å‹ï¼ˆç©ºè°ƒã€ç¯ã€çª—å¸˜ï¼‰
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•
- [ ] ä¼˜åŒ–æ€§èƒ½

### ä¸­æœŸè®¡åˆ’ï¼ˆ1-2æœˆï¼‰
- [ ] æ”¯æŒåä¸ºå°è‰ºéŸ³ç®±
- [ ] æ”¯æŒäº¬ä¸œå®å’šéŸ³ç®±
- [ ] å®ç°ç»Ÿä¸€é€‚é…å±‚
- [ ] å¼€å‘ç®¡ç†åå°

### é•¿æœŸè®¡åˆ’ï¼ˆ3-6æœˆï¼‰
- [ ] æ”¯æŒæ‰€æœ‰ä¸»æµå¹³å°
- [ ] å®ç°è®¾å¤‡çŠ¶æ€æ¨é€
- [ ] æ·»åŠ æ•°æ®åˆ†æ
- [ ] å¼€å‘ç§»åŠ¨ç«¯ App

## ğŸ“ éƒ¨ç½²æ¸…å•

### æ•°æ®åº“é…ç½®
```sql
-- ä¸‰ä¸ªå¹³å°çš„å®¢æˆ·ç«¯é…ç½®
INSERT INTO oauth_clients VALUES 
  ('aligenie_client_id', '...', 'https://aligenie.com/callback', 1),
  ('xiaodu_client_id', '...', 'https://dueros.baidu.com/callback', 1),
  ('miai_client_id', '...', 'https://xiaoai.mi.com/callback', 1);
```

### å¹³å°é…ç½®

**å¤©çŒ«ç²¾çµå¼€æ”¾å¹³å°**:
- OAuth: https://your-domain.com/authorize
- Webhook: https://your-domain.com/smarthome/*

**å°åº¦å¼€æ”¾å¹³å°**:
- OAuth: https://your-domain.com/authorize
- Webhook: https://your-domain.com/dueros/*

**å°ç±³ IoT å¹³å°**:
- OAuth: https://your-domain.com/authorize
- Webhook: https://your-domain.com/miai/*

## ğŸ‰ é¡¹ç›®æˆæœ

### æŠ€æœ¯æˆæœ
- âœ… ä¸€å¥—åç«¯æ”¯æŒä¸‰å¤§å¹³å°
- âœ… ä»£ç å¤ç”¨ç‡ 80%+
- âœ… å¼€å‘æ•ˆç‡æå‡ 90%+
- âœ… å¸‚åœºè¦†ç›–ç‡ 75%+

### æ–‡æ¡£æˆæœ
- âœ… 10+ ä»½å®Œæ•´æ–‡æ¡£
- âœ… è¯¦ç»†çš„å¯¹æ¯”åˆ†æ
- âœ… å®Œæ•´çš„æµ‹è¯•æŒ‡å—
- âœ… æœ€ä½³å®è·µæ€»ç»“

### ä»£ç æˆæœ
- âœ… 9 ä¸ª Controller/DTO æ–‡ä»¶
- âœ… ~1750 è¡Œä»£ç 
- âœ… å®Œæ•´çš„åŠŸèƒ½å®ç°
- âœ… é«˜è´¨é‡ä»£ç 

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£èµ„æº
- å¤©çŒ«ç²¾çµ: æŸ¥çœ‹åŸæœ‰æ–‡æ¡£
- å°åº¦éŸ³ç®±: æŸ¥çœ‹ `å°åº¦éŸ³ç®±å¯¹æ¥æ–¹æ¡ˆ.md`
- å°çˆ±åŒå­¦: æŸ¥çœ‹ `å°çˆ±åŒå­¦å¯¹æ¥æ–¹æ¡ˆ.md`
- å¹³å°å¯¹æ¯”: æŸ¥çœ‹ `å¤šå¹³å°å¯¹æ¥æ–¹æ¡ˆå¯¹æ¯”.md`

### æµ‹è¯•æŒ‡å—
- å°åº¦éŸ³ç®±: `å°åº¦éŸ³ç®±æµ‹è¯•æŒ‡å—.md`
- å°çˆ±åŒå­¦: `å°çˆ±åŒå­¦æµ‹è¯•æŒ‡å—.md`

## ğŸ† æ€»ç»“

é€šè¿‡ç»Ÿä¸€çš„æ¶æ„è®¾è®¡å’Œé«˜åº¦çš„ä»£ç å¤ç”¨ï¼ŒæˆåŠŸå®ç°äº†ï¼š

1. **ä¸€å¥—åç«¯ï¼Œä¸‰ä¸ªå¹³å°**: åŒæ—¶æ”¯æŒå¤©çŒ«ç²¾çµã€å°åº¦éŸ³ç®±ã€å°çˆ±åŒå­¦
2. **é«˜æ•ˆå¼€å‘**: ç¬¬äºŒã€ç¬¬ä¸‰å¹³å°å¼€å‘æ—¶é—´ç¼©çŸ­ 90%+
3. **æ˜“äºç»´æŠ¤**: 80% ä»£ç å…±ç”¨ï¼Œç»´æŠ¤æˆæœ¬ä½
4. **å¸‚åœºè¦†ç›–**: è¦†ç›– 75% çš„æ™ºèƒ½éŸ³ç®±å¸‚åœº

è¿™æ˜¯ä¸€ä¸ªæˆåŠŸçš„å¤šå¹³å°å¯¹æ¥æ¡ˆä¾‹ï¼Œè¯æ˜äº†è‰¯å¥½çš„æ¶æ„è®¾è®¡å¯ä»¥å¸¦æ¥å·¨å¤§çš„æ•ˆç‡æå‡ï¼

---

**é¡¹ç›®çŠ¶æ€**: âœ… ä¸‰å¹³å°å…¨éƒ¨å®Œæˆ  
**å®Œæˆæ—¥æœŸ**: 2026-02-24  
**æ€»å¼€å‘æ—¶é—´**: 7-8 å¤©  
**ä»£ç è´¨é‡**: ä¼˜ç§€  
**æ–‡æ¡£å®Œå–„åº¦**: ä¼˜ç§€

{
  "info": {
    "name": "小爱同学智能家居 API",
    "description": "小米小爱同学智能家居控制 API 测试集合\n\n## 使用说明\n\n1. 导入此集合到 Postman\n2. 设置环境变量:\n   - base_url: http://localhost:8080\n   - username: user1\n   - password: password\n   - client_id: miai-client\n   - client_secret: miai-secret\n3. 先运行 \"获取访问令牌\" 请求\n4. access_token 会自动保存到环境变量\n5. 运行其他测试请求\n\n## 特点\n\n- 小爱同学使用扁平化的 JSON 结构\n- 操作名称使用小写+连字符格式（如 turn-on）\n- 响应格式简洁：code + message + data\n\n## 测试覆盖\n\n- 健康检查\n- 设备发现\n- 设备控制 (开/关/暂停/继续/设置模式)\n- 设备查询\n- 错误处理\n\n版本: 2.0\n更新时间: 2026-02-25",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "小爱同学测试"
  },
  "item": [
    {
      "name": "OAuth2 认证",
      "item": [
        {
          "name": "获取访问令牌",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response has access_token\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('access_token');",
                  "    pm.environment.set(\"access_token\", jsonData.access_token);",
                  "});",
                  "",
                  "pm.test(\"Token type is Bearer\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.token_type).to.eql(\"Bearer\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/x-www-form-urlencoded"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "password",
                  "type": "text"
                },
                {
                  "key": "username",
                  "value": "{{username}}",
                  "type": "text"
                },
                {
                  "key": "password",
                  "value": "{{password}}",
                  "type": "text"
                },
                {
                  "key": "client_id",
                  "value": "{{client_id}}",
                  "type": "text"
                },
                {
                  "key": "client_secret",
                  "value": "{{client_secret}}",
                  "type": "text"
                }
              ]
            },
            "url": {
              "raw": "{{base_url}}/oauth2/token",
              "host": ["{{base_url}}"],
              "path": ["oauth2", "token"]
            },
            "description": "使用密码模式获取访问令牌"
          },
          "response": []
        }
      ]
    },
    {
      "name": "健康检查",
      "item": [
        {
          "name": "健康检查",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response code is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "});",
                  "",
                  "pm.test(\"Platform is xiaomi-miai\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.platform).to.eql(\"xiaomi-miai\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/miai/health",
              "host": ["{{base_url}}"],
              "path": ["miai", "health"]
            },
            "description": "检查小爱同学服务健康状态"
          },
          "response": []
        }
      ]
    },
    {
      "name": "设备发现",
      "item": [
        {
          "name": "发现所有设备",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response code is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "});",
                  "",
                  "pm.test(\"Response contains devices\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('devices');",
                  "    pm.expect(jsonData.data.devices).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{base_url}}/miai/discovery",
              "host": ["{{base_url}}"],
              "path": ["miai", "discovery"]
            },
            "description": "发现用户的所有智能设备"
          },
          "response": []
        }
      ]
    },
    {
      "name": "设备控制",
      "item": [
        {
          "name": "设备开机",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response code is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"turn-on\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-turnon-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "打开设备电源"
          },
          "response": []
        },
        {
          "name": "设备关机",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response code is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"turn-off\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-turnoff-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "关闭设备电源"
          },
          "response": []
        },
        {
          "name": "设备暂停",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"pause\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-pause-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "暂停设备工作"
          },
          "response": []
        },
        {
          "name": "设备继续",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"continue\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-continue-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "继续设备工作"
          },
          "response": []
        },
        {
          "name": "设置模式 - 自动",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"set-mode\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-setmode-auto-001\",\n  \"params\": {\n    \"mode\": \"auto\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "设置设备为自动模式"
          },
          "response": []
        },
        {
          "name": "设置模式 - 定点",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"set-mode\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-setmode-spot-001\",\n  \"params\": {\n    \"mode\": \"spot\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "设置设备为定点清扫模式"
          },
          "response": []
        },
        {
          "name": "设置模式 - 沿边",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"set-mode\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-setmode-edge-001\",\n  \"params\": {\n    \"mode\": \"edge\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "设置设备为沿边清扫模式"
          },
          "response": []
        }
      ]
    },
    {
      "name": "设备查询",
      "item": [
        {
          "name": "查询设备状态",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Response code is 0\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(0);",
                  "});",
                  "",
                  "pm.test(\"Response contains status\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('status');",
                  "    pm.expect(jsonData.data.status).to.have.property('power_state');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-query-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/query",
              "host": ["{{base_url}}"],
              "path": ["miai", "query"]
            },
            "description": "查询设备当前状态"
          },
          "response": []
        }
      ]
    },
    {
      "name": "错误处理",
      "item": [
        {
          "name": "无效Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 401\", function () {",
                  "    pm.response.to.have.status(401);",
                  "});",
                  "",
                  "pm.test(\"Error code is 401\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(401);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer invalid_token_12345"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{base_url}}/miai/discovery",
              "host": ["{{base_url}}"],
              "path": ["miai", "discovery"]
            },
            "description": "测试无效Token的错误处理"
          },
          "response": []
        },
        {
          "name": "设备不存在",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Error code is 404\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(404);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"turn-on\",\n  \"deviceId\": \"non-existent-device\",\n  \"requestId\": \"req-error-device-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "测试设备不存在的错误处理"
          },
          "response": []
        },
        {
          "name": "无效模式",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Error code is 400\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"intent\": \"set-mode\",\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-error-mode-001\",\n  \"params\": {\n    \"mode\": \"invalid_mode\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "测试无效模式的错误处理"
          },
          "response": []
        },
        {
          "name": "缺少Intent参数",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test(\"Error code is 400\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.code).to.eql(400);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"deviceId\": \"vacuum-001\",\n  \"requestId\": \"req-error-intent-001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/miai/control",
              "host": ["{{base_url}}"],
              "path": ["miai", "control"]
            },
            "description": "测试缺少Intent参数的错误处理"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "username",
      "value": "user1",
      "type": "string"
    },
    {
      "key": "password",
      "value": "password",
      "type": "string"
    },
    {
      "key": "client_id",
      "value": "miai-client",
      "type": "string"
    },
    {
      "key": "client_secret",
      "value": "miai-secret",
      "type": "string"
    }
  ]
}

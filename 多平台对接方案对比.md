# æ™ºèƒ½éŸ³ç®±å¤šå¹³å°å¯¹æ¥æ–¹æ¡ˆå¯¹æ¯”

## ğŸ“Š ä¸»æµå¹³å°å¯¹æ¯”

| å¹³å° | å¤©çŒ«ç²¾çµ | å°åº¦éŸ³ç®± | å°ç±³å°çˆ± | åä¸ºå°è‰º |
|------|---------|---------|---------|---------|
| å¼€å‘å¹³å° | å¤©çŒ«ç²¾çµå¼€æ”¾å¹³å° | ç™¾åº¦ DuerOS | å°ç±³ IoT å¹³å° | åä¸º HiLink |
| æˆæƒåè®® | OAuth 2.0 | OAuth 2.0 | OAuth 2.0 | OAuth 2.0 |
| é€šä¿¡åè®® | HTTPS + JSON | HTTPS + JSON | HTTPS + JSON | HTTPS + JSON |
| å¸‚åœºä»½é¢ | ~30% | ~25% | ~20% | ~15% |
| å¼€å‘éš¾åº¦ | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| æ–‡æ¡£å®Œå–„åº¦ | â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­ |

## ğŸ”„ æ ¸å¿ƒæµç¨‹å¯¹æ¯”

### 1. OAuth æˆæƒæµç¨‹ï¼ˆæ‰€æœ‰å¹³å°ç›¸åŒï¼‰

```
ç”¨æˆ· â†’ è¯­éŸ³ App â†’ æˆæƒè¯·æ±‚ â†’ å±•ç¤ºæˆæƒé¡µé¢ â†’ ç”¨æˆ·ç¡®è®¤
     â†’ ç”Ÿæˆ code â†’ é‡å®šå‘ â†’ ç”¨ code æ¢ token â†’ è¿”å› access_token
```

### 2. è®¾å¤‡å‘ç°æµç¨‹ï¼ˆæ‰€æœ‰å¹³å°ç›¸åŒï¼‰

```
è¯­éŸ³æŒ‡ä»¤ â†’ å¹³å°è§£æ â†’ POST /discovery â†’ éªŒè¯ token 
        â†’ æŸ¥è¯¢è®¾å¤‡ â†’ è¿”å›è®¾å¤‡åˆ—è¡¨
```

### 3. è®¾å¤‡æ§åˆ¶æµç¨‹ï¼ˆæ‰€æœ‰å¹³å°ç›¸åŒï¼‰

```
è¯­éŸ³æŒ‡ä»¤ â†’ å¹³å°è§£æ â†’ POST /control â†’ éªŒè¯ token 
        â†’ æ‰§è¡Œæ“ä½œ â†’ è¿”å›ç»“æœ
```

## ğŸ“‹ è¯·æ±‚æ ¼å¼å¯¹æ¯”

### å¤©çŒ«ç²¾çµï¼ˆAliGenieï¼‰

```json
{
  "header": {
    "namespace": "AliGenie.Iot.Device.Control",
    "name": "TurnOn",
    "messageId": "1234567890",
    "payloadVersion": "1"
  },
  "payload": {
    "deviceId": "robot_001"
  }
}
```

### å°åº¦éŸ³ç®±ï¼ˆDuerOSï¼‰

```json
{
  "header": {
    "namespace": "DuerOS.ConnectedHome.Control",
    "name": "TurnOnRequest",
    "messageId": "1234567890",
    "payloadVersion": "1.0"
  },
  "payload": {
    "accessToken": "xxx",
    "appliance": {
      "applianceId": "robot_001"
    }
  }
}
```

### å°ç±³å°çˆ±ï¼ˆMiAIï¼‰

```json
{
  "header": {
    "namespace": "control",
    "name": "action",
    "messageId": "1234567890"
  },
  "payload": {
    "deviceId": "robot_001",
    "action": "turn-on"
  }
}
```

## ğŸ¯ è®¾å¤‡ç±»å‹æ˜ å°„

| è®¾å¤‡ç±»å‹ | å¤©çŒ«ç²¾çµ | å°åº¦éŸ³ç®± | å°ç±³å°çˆ± |
|---------|---------|---------|---------|
| æ‰«åœ°æœºå™¨äºº | robot_cleaner | ROBOT_CLEANER | vacuum-cleaner |
| ç©ºè°ƒ | aircondition | AIR_CONDITIONER | air-conditioner |
| ç¯ | light | LIGHT | light |
| æ’åº§ | outlet | SMARTPLUG | outlet |
| çª—å¸˜ | curtain | CURTAIN | curtain |

## ğŸ”§ æ“ä½œæŒ‡ä»¤æ˜ å°„

| æ“ä½œ | å¤©çŒ«ç²¾çµ | å°åº¦éŸ³ç®± | å°ç±³å°çˆ± |
|------|---------|---------|---------|
| å¼€æœº | TurnOn | TurnOnRequest | turn-on |
| å…³æœº | TurnOff | TurnOffRequest | turn-off |
| æš‚åœ | Pause | PauseRequest | pause |
| ç»§ç»­ | Continue | ContinueRequest | continue |
| è®¾ç½®æ¨¡å¼ | SetMode | SetModeRequest | set-mode |

## ğŸ’¡ ç»Ÿä¸€é€‚é…æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¶æ„

```
è¯­éŸ³å¹³å°è¯·æ±‚
    â†“
å¹³å°è¯†åˆ«ä¸­é—´ä»¶
    â†“
ç»Ÿä¸€è¯·æ±‚æ ¼å¼è½¬æ¢
    â†“
ä¸šåŠ¡é€»è¾‘å¤„ç†
    â†“
ç»Ÿä¸€å“åº”æ ¼å¼è½¬æ¢
    â†“
è¿”å›å¯¹åº”å¹³å°æ ¼å¼
```

### æ ¸å¿ƒä»£ç ç»“æ„

```java
// ç»Ÿä¸€è¯·æ±‚å¯¹è±¡
public class UnifiedRequest {
    private String platform;      // aligenie, dueros, miai
    private String action;        // turnOn, turnOff, pause
    private String deviceId;
    private Map<String, Object> params;
}

// ç»Ÿä¸€å“åº”å¯¹è±¡
public class UnifiedResponse {
    private boolean success;
    private String message;
    private Map<String, Object> data;
}

// å¹³å°é€‚é…å™¨æ¥å£
public interface VoicePlatformAdapter {
    UnifiedRequest parseRequest(String rawRequest);
    String formatResponse(UnifiedResponse response);
}

// å¤©çŒ«ç²¾çµé€‚é…å™¨
public class AliGenieAdapter implements VoicePlatformAdapter {
    @Override
    public UnifiedRequest parseRequest(String rawRequest) {
        // è§£æå¤©çŒ«ç²¾çµæ ¼å¼
    }
    
    @Override
    public String formatResponse(UnifiedResponse response) {
        // è½¬æ¢ä¸ºå¤©çŒ«ç²¾çµæ ¼å¼
    }
}

// å°åº¦éŸ³ç®±é€‚é…å™¨
public class DuerOSAdapter implements VoicePlatformAdapter {
    @Override
    public UnifiedRequest parseRequest(String rawRequest) {
        // è§£æå°åº¦æ ¼å¼
    }
    
    @Override
    public String formatResponse(UnifiedResponse response) {
        // è½¬æ¢ä¸ºå°åº¦æ ¼å¼
    }
}
```

## ğŸ“ˆ å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šå•å¹³å°éªŒè¯
1. é€‰æ‹©ä¸€ä¸ªå¹³å°ï¼ˆæ¨èå¤©çŒ«ç²¾çµï¼Œæ–‡æ¡£æœ€å®Œå–„ï¼‰
2. å®ŒæˆåŸºç¡€åŠŸèƒ½å¼€å‘
3. å……åˆ†æµ‹è¯•éªŒè¯

### ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•ç¬¬äºŒå¹³å°
1. æ·»åŠ å°åº¦éŸ³ç®±æ”¯æŒ
2. å®ç°å¹³å°é€‚é…å±‚
3. æµ‹è¯•ä¸¤ä¸ªå¹³å°

### ç¬¬ä¸‰é˜¶æ®µï¼šå¤šå¹³å°æ”¯æŒ
1. æ·»åŠ å°ç±³ã€åä¸ºç­‰å¹³å°
2. ä¼˜åŒ–é€‚é…å±‚
3. ç»Ÿä¸€ç®¡ç†åå°

## ğŸ“ æœ€ä½³å®è·µ

### 1. ä»£ç å¤ç”¨
- OAuth æˆæƒæµç¨‹å®Œå…¨ç›¸åŒï¼Œå¯ä»¥å…±ç”¨
- æ•°æ®åº“è®¾è®¡ç»Ÿä¸€ï¼Œæ”¯æŒå¤šå¹³å°
- ä¸šåŠ¡é€»è¾‘å±‚å¹³å°æ— å…³

### 2. é…ç½®ç®¡ç†
```yaml
voice-platforms:
  aligenie:
    enabled: true
    client-id: xxx
    client-secret: xxx
  dueros:
    enabled: true
    client-id: xxx
    client-secret: xxx
  miai:
    enabled: false
```

### 3. ç»Ÿä¸€æ—¥å¿—
```java
log.info("å¹³å°: {}, æ“ä½œ: {}, è®¾å¤‡: {}, ç»“æœ: {}", 
    platform, action, deviceId, result);
```

### 4. é”™è¯¯å¤„ç†
```java
public class VoicePlatformException extends RuntimeException {
    private String platform;
    private String errorCode;
    private String errorMessage;
}
```

## ğŸš€ å¿«é€Ÿå¼€å‘æŒ‡å—

### æ­¥éª¤ 1: åŸºäºç°æœ‰é¡¹ç›®æ‰©å±•

å·²æœ‰å¤©çŒ«ç²¾çµé¡¹ç›®ï¼Œæ·»åŠ å°åº¦æ”¯æŒåªéœ€ï¼š

1. åˆ›å»º `DuerOSController`ï¼ˆçº¦ 100 è¡Œä»£ç ï¼‰
2. åˆ›å»º `DuerOSRequest/Response`ï¼ˆçº¦ 50 è¡Œä»£ç ï¼‰
3. æ‰©å±• `DeviceService`ï¼ˆçº¦ 50 è¡Œä»£ç ï¼‰
4. æ·»åŠ æ•°æ®åº“é…ç½®ï¼ˆ1 æ¡ SQLï¼‰

**æ€»è®¡ï¼šçº¦ 200 è¡Œä»£ç ï¼Œ1-2 å°æ—¶å®Œæˆ**

### æ­¥éª¤ 2: æµ‹è¯•éªŒè¯

1. æœ¬åœ°æµ‹è¯• OAuth æµç¨‹
2. æµ‹è¯•è®¾å¤‡å‘ç°
3. æµ‹è¯•è®¾å¤‡æ§åˆ¶
4. åœ¨çœŸæœºä¸Šæµ‹è¯•è¯­éŸ³æ§åˆ¶

### æ­¥éª¤ 3: ä¸Šçº¿éƒ¨ç½²

1. éƒ¨ç½²åˆ°æœåŠ¡å™¨
2. é…ç½® HTTPS
3. åœ¨å„å¹³å°æäº¤å®¡æ ¸
4. å‘å¸ƒä¸Šçº¿

## ğŸ“Š æˆæœ¬æ”¶ç›Šåˆ†æ

### å¼€å‘æˆæœ¬

| å¹³å° | é¦–æ¬¡å¼€å‘ | å¢é‡å¼€å‘ | ç»´æŠ¤æˆæœ¬ |
|------|---------|---------|---------|
| ç¬¬ä¸€ä¸ªå¹³å° | 5-7 å¤© | - | ä½ |
| ç¬¬äºŒä¸ªå¹³å° | - | 1-2 å¤© | ä½ |
| ç¬¬ä¸‰ä¸ªå¹³å° | - | 1-2 å¤© | ä½ |

### æ”¶ç›Šåˆ†æ

- è¦†ç›–æ›´å¤šç”¨æˆ·ç¾¤ä½“
- æå‡å“ç‰Œå½±å“åŠ›
- å¢åŠ äº§å“ç«äº‰åŠ›
- é™ä½å¹³å°ä¾èµ–é£é™©

## ğŸ¯ æ¨èæ–¹æ¡ˆ

### å°å‹é¡¹ç›®ï¼ˆ1-2 äººå›¢é˜Ÿï¼‰
- ä¼˜å…ˆæ”¯æŒ 1-2 ä¸ªä¸»æµå¹³å°
- ä½¿ç”¨ç‹¬ç«‹ Controller æ–¹æ¡ˆ
- å¿«é€Ÿä¸Šçº¿ï¼Œè¿­ä»£ä¼˜åŒ–

### ä¸­å‹é¡¹ç›®ï¼ˆ3-5 äººå›¢é˜Ÿï¼‰
- æ”¯æŒ 2-3 ä¸ªä¸»æµå¹³å°
- å®ç°ç®€å•çš„é€‚é…å±‚
- ç»Ÿä¸€ç®¡ç†åå°

### å¤§å‹é¡¹ç›®ï¼ˆ5+ äººå›¢é˜Ÿï¼‰
- æ”¯æŒæ‰€æœ‰ä¸»æµå¹³å°
- å®Œå–„çš„é€‚é…å±‚æ¶æ„
- ç»Ÿä¸€çš„è®¾å¤‡ç®¡ç†å¹³å°
- æ•°æ®åˆ†æå’Œç›‘æ§

## ğŸ“ æ€»ç»“

1. **æ ¸å¿ƒæµç¨‹ç›¸åŒ**: æ‰€æœ‰å¹³å°éƒ½æ˜¯ OAuth + Webhook
2. **æ ¼å¼ç•¥æœ‰å·®å¼‚**: ä¸»è¦æ˜¯ JSON å­—æ®µåç§°ä¸åŒ
3. **æ˜“äºæ‰©å±•**: åŸºäºç¬¬ä¸€ä¸ªå¹³å°ï¼Œæ‰©å±•å…¶ä»–å¹³å°å¾ˆå¿«
4. **å»ºè®®ç­–ç•¥**: å…ˆåšå¥½ä¸€ä¸ªï¼Œå†é€æ­¥æ‰©å±•

é€šè¿‡ç»Ÿä¸€çš„æ¶æ„è®¾è®¡ï¼Œå¯ä»¥ç”¨æœ€å°çš„æˆæœ¬æ”¯æŒå¤šä¸ªè¯­éŸ³å¹³å°ï¼Œå®ç°"ä¸€æ¬¡å¼€å‘ï¼Œå¤šå¹³å°éƒ¨ç½²"çš„ç›®æ ‡ï¼

# å¹³å°é…ç½®è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è·å–å’Œé…ç½®ä¸‰å¤§æ™ºèƒ½éŸ³ç®±å¹³å°çš„ OAuth å®¢æˆ·ç«¯ä¿¡æ¯ã€‚

## ğŸ¯ éœ€è¦é…ç½®çš„ä¿¡æ¯

æ¯ä¸ªå¹³å°éœ€è¦é…ç½®ä»¥ä¸‹ä¿¡æ¯ï¼š
- `client_id`ï¼šOAuth å®¢æˆ·ç«¯ ID
- `client_secret`ï¼šOAuth å®¢æˆ·ç«¯å¯†é’¥
- `redirect_uri`ï¼šOAuth å›è°ƒåœ°å€

## 1ï¸âƒ£ å¤©çŒ«ç²¾çµï¼ˆAliGenieï¼‰

### è·å–æ­¥éª¤

1. **æ³¨å†Œå¼€å‘è€…è´¦å·**
   - è®¿é—®ï¼šhttps://aligenie.com
   - æ³¨å†Œå¹¶ç™»å½•å¼€å‘è€…è´¦å·

2. **åˆ›å»ºæŠ€èƒ½**
   - è¿›å…¥"å¼€å‘è€…ä¸­å¿ƒ"
   - ç‚¹å‡»"åˆ›å»ºæŠ€èƒ½"
   - é€‰æ‹©"æ™ºèƒ½å®¶å±…æŠ€èƒ½"

3. **é…ç½® OAuth**
   - åœ¨æŠ€èƒ½é…ç½®ä¸­æ‰¾åˆ°"è´¦å·æˆæƒ"
   - é€‰æ‹©"OAuth 2.0"
   - å¡«å†™æˆæƒé…ç½®ï¼š
     - æˆæƒé¡µé¢ URLï¼š`https://your-domain.com/authorize`
     - Token URLï¼š`https://your-domain.com/token`
     - Client IDï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ
     - Client Secretï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ
     - Redirect URIï¼š`https://aligenie.com/callback`

4. **é…ç½® Webhook**
   - åœ¨æŠ€èƒ½é…ç½®ä¸­æ‰¾åˆ°"æœåŠ¡é…ç½®"
   - å¡«å†™æœåŠ¡åœ°å€ï¼š
     - è®¾å¤‡å‘ç°ï¼š`https://your-domain.com/smarthome/discovery`
     - è®¾å¤‡æ§åˆ¶ï¼š`https://your-domain.com/smarthome/control`
     - è®¾å¤‡æŸ¥è¯¢ï¼š`https://your-domain.com/smarthome/query`

5. **è·å–é…ç½®ä¿¡æ¯**
   - å¤åˆ¶ Client ID å’Œ Client Secret
   - è®°å½• Redirect URI

### é…ç½®åˆ°æ•°æ®åº“

```sql
-- æ›¿æ¢ä»¥ä¸‹å ä½ç¬¦
UPDATE oauth_clients 
SET 
    client_id = 'ä½ çš„å¤©çŒ«ç²¾çµClient ID',
    client_secret = 'ä½ çš„å¤©çŒ«ç²¾çµClient Secret',
    redirect_uri = 'https://aligenie.com/callback'
WHERE client_id = 'YOUR_ALIGENIE_CLIENT_ID';
```

### æµ‹è¯•é…ç½®

```bash
# 1. åœ¨å¤©çŒ«ç²¾çµ App ä¸­æ·»åŠ æŠ€èƒ½
# 2. ç‚¹å‡»"è´¦å·æˆæƒ"
# 3. è¾“å…¥æµ‹è¯•è´¦å·ï¼štestuser / password123
# 4. æˆæƒæˆåŠŸåï¼Œè¯´"å¤©çŒ«ç²¾çµï¼Œå‘ç°è®¾å¤‡"
# 5. åº”è¯¥èƒ½å‘ç° 4 å°æ‰«åœ°æœºå™¨äºº
```

---

## 2ï¸âƒ£ å°åº¦éŸ³ç®±ï¼ˆDuerOSï¼‰

### è·å–æ­¥éª¤

1. **æ³¨å†Œå¼€å‘è€…è´¦å·**
   - è®¿é—®ï¼šhttps://dueros.baidu.com
   - æ³¨å†Œå¹¶ç™»å½•å¼€å‘è€…è´¦å·

2. **åˆ›å»ºæŠ€èƒ½**
   - è¿›å…¥"æŠ€èƒ½å¼€æ”¾å¹³å°"
   - ç‚¹å‡»"åˆ›å»ºæŠ€èƒ½"
   - é€‰æ‹©"æ™ºèƒ½å®¶å±…æŠ€èƒ½"

3. **é…ç½® OAuth**
   - åœ¨æŠ€èƒ½é…ç½®ä¸­æ‰¾åˆ°"è´¦å·å…³è”"
   - é€‰æ‹©"OAuth 2.0"
   - å¡«å†™æˆæƒé…ç½®ï¼š
     - æˆæƒ URLï¼š`https://your-domain.com/authorize`
     - Token URLï¼š`https://your-domain.com/token`
     - Client IDï¼šè‡ªå®šä¹‰æˆ–ç³»ç»Ÿç”Ÿæˆ
     - Client Secretï¼šè‡ªå®šä¹‰æˆ–ç³»ç»Ÿç”Ÿæˆ
     - Redirect URIï¼š`https://dueros.baidu.com/callback`

4. **é…ç½®æœåŠ¡åœ°å€**
   - åœ¨æŠ€èƒ½é…ç½®ä¸­æ‰¾åˆ°"æœåŠ¡é…ç½®"
   - å¡«å†™æœåŠ¡åœ°å€ï¼š
     - è®¾å¤‡å‘ç°ï¼š`https://your-domain.com/dueros/discovery`
     - è®¾å¤‡æ§åˆ¶ï¼š`https://your-domain.com/dueros/control`

5. **è·å–é…ç½®ä¿¡æ¯**
   - å¤åˆ¶ Client ID å’Œ Client Secret
   - è®°å½• Redirect URI

### é…ç½®åˆ°æ•°æ®åº“

```sql
-- æ›¿æ¢ä»¥ä¸‹å ä½ç¬¦
UPDATE oauth_clients 
SET 
    client_id = 'ä½ çš„å°åº¦Client ID',
    client_secret = 'ä½ çš„å°åº¦Client Secret',
    redirect_uri = 'https://dueros.baidu.com/callback'
WHERE client_id = 'YOUR_DUEROS_CLIENT_ID';
```

### æµ‹è¯•é…ç½®

```bash
# 1. åœ¨å°åº¦ App ä¸­æ·»åŠ æŠ€èƒ½
# 2. ç‚¹å‡»"è´¦å·æˆæƒ"
# 3. è¾“å…¥æµ‹è¯•è´¦å·ï¼štestuser / password123
# 4. æˆæƒæˆåŠŸåï¼Œè¯´"å°åº¦å°åº¦ï¼Œå‘ç°è®¾å¤‡"
# 5. åº”è¯¥èƒ½å‘ç° 4 å°æ‰«åœ°æœºå™¨äºº
```

---

## 3ï¸âƒ£ å°çˆ±åŒå­¦ï¼ˆMiAIï¼‰

### è·å–æ­¥éª¤

1. **æ³¨å†Œå¼€å‘è€…è´¦å·**
   - è®¿é—®ï¼šhttps://iot.mi.com
   - æ³¨å†Œå¹¶ç™»å½•å°ç±³å¼€å‘è€…è´¦å·

2. **åˆ›å»ºäº§å“**
   - è¿›å…¥"å°ç±³ IoT å¼€å‘è€…å¹³å°"
   - ç‚¹å‡»"åˆ›å»ºæ–°äº§å“"
   - é€‰æ‹©"æ‰«åœ°æœºå™¨äºº"ç±»åˆ«

3. **é…ç½® OAuth**
   - åœ¨äº§å“é…ç½®ä¸­æ‰¾åˆ°"è´¦å·æˆæƒ"
   - é€‰æ‹©"OAuth 2.0"
   - å¡«å†™æˆæƒé…ç½®ï¼š
     - æˆæƒ URLï¼š`https://your-domain.com/authorize`
     - Token URLï¼š`https://your-domain.com/token`
     - Client IDï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ
     - Client Secretï¼šç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ
     - Redirect URIï¼š`https://xiaoai.mi.com/callback`

4. **é…ç½®æœåŠ¡åœ°å€**
   - åœ¨äº§å“é…ç½®ä¸­æ‰¾åˆ°"æœåŠ¡é…ç½®"
   - å¡«å†™æœåŠ¡åœ°å€ï¼š
     - è®¾å¤‡å‘ç°ï¼š`https://your-domain.com/miai/discovery`
     - è®¾å¤‡æ§åˆ¶ï¼š`https://your-domain.com/miai/control`
     - è®¾å¤‡æŸ¥è¯¢ï¼š`https://your-domain.com/miai/query`
     - å¥åº·æ£€æŸ¥ï¼š`https://your-domain.com/miai/health`

5. **è·å–é…ç½®ä¿¡æ¯**
   - å¤åˆ¶ Client ID å’Œ Client Secret
   - è®°å½• Redirect URI

### é…ç½®åˆ°æ•°æ®åº“

```sql
-- æ›¿æ¢ä»¥ä¸‹å ä½ç¬¦
UPDATE oauth_clients 
SET 
    client_id = 'ä½ çš„å°çˆ±Client ID',
    client_secret = 'ä½ çš„å°çˆ±Client Secret',
    redirect_uri = 'https://xiaoai.mi.com/callback'
WHERE client_id = 'YOUR_MIAI_CLIENT_ID';
```

### æµ‹è¯•é…ç½®

```bash
# 1. åœ¨å°ç±³æ™ºèƒ½å®¶å±… App ä¸­æ·»åŠ è®¾å¤‡
# 2. é€‰æ‹©"å…¶ä»–å¹³å°è®¾å¤‡"
# 3. è¾“å…¥æµ‹è¯•è´¦å·ï¼štestuser / password123
# 4. æˆæƒæˆåŠŸåï¼Œè¯´"å°çˆ±åŒå­¦ï¼Œå‘ç°è®¾å¤‡"
# 5. åº”è¯¥èƒ½å‘ç° 4 å°æ‰«åœ°æœºå™¨äºº
```

---

## ğŸ”§ å®Œæ•´é…ç½®æµç¨‹

### æ­¥éª¤ 1ï¼šå‡†å¤‡åŸŸåå’Œ HTTPS

```bash
# 1. å‡†å¤‡ä¸€ä¸ªå…¬ç½‘å¯è®¿é—®çš„åŸŸå
# ä¾‹å¦‚ï¼šsmarthome.example.com

# 2. é…ç½® HTTPS è¯ä¹¦ï¼ˆå¿…é¡»ï¼‰
# å¯ä»¥ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦
# æˆ–è€…ä½¿ç”¨äº‘æœåŠ¡å•†æä¾›çš„è¯ä¹¦

# 3. ç¡®ä¿ä»¥ä¸‹åœ°å€å¯è®¿é—®ï¼š
# https://your-domain.com/authorize
# https://your-domain.com/token
# https://your-domain.com/smarthome/*
# https://your-domain.com/dueros/*
# https://your-domain.com/miai/*
```

### æ­¥éª¤ 2ï¼šéƒ¨ç½²åº”ç”¨

```bash
# 1. éƒ¨ç½² Spring Boot åº”ç”¨åˆ°æœåŠ¡å™¨
java -jar aligenie-smarthome-1.0.0.jar

# 2. é…ç½® Nginx åå‘ä»£ç†
# å°†åŸŸåæŒ‡å‘æœ¬åœ° 8080 ç«¯å£

# 3. æµ‹è¯•æœåŠ¡æ˜¯å¦æ­£å¸¸
curl https://your-domain.com/miai/health
```

### æ­¥éª¤ 3ï¼šé…ç½®å¹³å°

æŒ‰ç…§ä¸Šè¿°ä¸‰ä¸ªå¹³å°çš„æ­¥éª¤ï¼Œåˆ†åˆ«é…ç½®ï¼š
1. å¤©çŒ«ç²¾çµ
2. å°åº¦éŸ³ç®±
3. å°çˆ±åŒå­¦

### æ­¥éª¤ 4ï¼šå¯¼å…¥æµ‹è¯•æ•°æ®

```bash
# 1. ç¼–è¾‘ test-data.sqlï¼Œæ›¿æ¢å ä½ç¬¦
# å°† YOUR_ALIGENIE_CLIENT_ID ç­‰æ›¿æ¢ä¸ºå®é™…å€¼

# 2. å¯¼å…¥æ•°æ®
mysql -u root -p smarthomedb < src/main/resources/test-data.sql

# 3. éªŒè¯æ•°æ®
mysql -u root -p smarthomedb -e "SELECT client_id, redirect_uri FROM oauth_clients;"
```

### æ­¥éª¤ 5ï¼šæµ‹è¯•

```bash
# 1. ä½¿ç”¨ Postman æµ‹è¯• OAuth æµç¨‹
# 2. ä½¿ç”¨ Postman æµ‹è¯•è®¾å¤‡å‘ç°å’Œæ§åˆ¶
# 3. åœ¨å„å¹³å° App ä¸­è¿›è¡Œè¯­éŸ³æµ‹è¯•
```

---

## ğŸ“ é…ç½®æ¨¡æ¿

### test-data.sql é…ç½®ç¤ºä¾‹

```sql
-- å¤©çŒ«ç²¾çµé…ç½®ç¤ºä¾‹
INSERT INTO oauth_clients (client_id, client_secret, redirect_uri, user_id) 
VALUES (
    'aligenie_abc123def456',              -- å®é™…çš„ client_id
    'secret_xyz789uvw012',                -- å®é™…çš„ client_secret
    'https://aligenie.com/callback',      -- å›è°ƒåœ°å€
    1
) ON DUPLICATE KEY UPDATE 
    client_secret = VALUES(client_secret),
    redirect_uri = VALUES(redirect_uri);

-- å°åº¦éŸ³ç®±é…ç½®ç¤ºä¾‹
INSERT INTO oauth_clients (client_id, client_secret, redirect_uri, user_id) 
VALUES (
    'dueros_ghi345jkl678',                -- å®é™…çš„ client_id
    'secret_mno901pqr234',                -- å®é™…çš„ client_secret
    'https://dueros.baidu.com/callback',  -- å›è°ƒåœ°å€
    1
) ON DUPLICATE KEY UPDATE 
    client_secret = VALUES(client_secret),
    redirect_uri = VALUES(redirect_uri);

-- å°çˆ±åŒå­¦é…ç½®ç¤ºä¾‹
INSERT INTO oauth_clients (client_id, client_secret, redirect_uri, user_id) 
VALUES (
    'miai_stu567vwx890',                  -- å®é™…çš„ client_id
    'secret_yza123bcd456',                -- å®é™…çš„ client_secret
    'https://xiaoai.mi.com/callback',     -- å›è°ƒåœ°å€
    1
) ON DUPLICATE KEY UPDATE 
    client_secret = VALUES(client_secret),
    redirect_uri = VALUES(redirect_uri);
```

---

## ğŸ§ª æµ‹è¯•æ•°æ®è¯´æ˜

### æµ‹è¯•ç”¨æˆ·

| ç”¨æˆ·å | å¯†ç  | é‚®ç®± | è®¾å¤‡æ•°é‡ |
|--------|------|------|---------|
| testuser | password123 | test@example.com | 4 å° |
| zhangsan | password123 | zhangsan@example.com | 2 å° |
| lisi | password123 | lisi@example.com | 1 å° |

### æµ‹è¯•è®¾å¤‡ï¼ˆtestuser ç”¨æˆ·ï¼‰

| è®¾å¤‡ID | è®¾å¤‡åç§° | çŠ¶æ€ | ç”µæº | æ¨¡å¼ | ç”µé‡ | è¯´æ˜ |
|--------|---------|------|------|------|------|------|
| robot_001 | å®¢å…æ‰«åœ°æœºå™¨äºº | åœ¨çº¿ | å¼€æœº | auto | 85% | æ­£å¸¸å·¥ä½œ |
| robot_002 | å§å®¤æ‰«åœ°æœºå™¨äºº | åœ¨çº¿ | å…³æœº | auto | 100% | å¾…æœºå……ç”µ |
| robot_003 | ä¹¦æˆ¿æ‰«åœ°æœºå™¨äºº | åœ¨çº¿ | å¼€æœº | spot | 15% | ä½ç”µé‡ |
| robot_004 | å¨æˆ¿æ‰«åœ°æœºå™¨äºº | ç¦»çº¿ | å…³æœº | auto | 0% | ç¦»çº¿çŠ¶æ€ |

### è¯­éŸ³æµ‹è¯•å‘½ä»¤

```bash
# å¤©çŒ«ç²¾çµ
"å¤©çŒ«ç²¾çµï¼Œæ‰“å¼€å®¢å…æ‰«åœ°æœºå™¨äºº"
"å¤©çŒ«ç²¾çµï¼Œå…³é—­å§å®¤æ‰«åœ°æœºå™¨äºº"
"å¤©çŒ«ç²¾çµï¼Œæš‚åœä¹¦æˆ¿æ‰«åœ°æœºå™¨äºº"
"å¤©çŒ«ç²¾çµï¼Œæ‰«åœ°æœºå™¨äººç”µé‡è¿˜æœ‰å¤šå°‘"

# å°åº¦éŸ³ç®±
"å°åº¦å°åº¦ï¼Œæ‰“å¼€å®¢å…æ‰«åœ°æœºå™¨äºº"
"å°åº¦å°åº¦ï¼Œå…³é—­å§å®¤æ‰«åœ°æœºå™¨äºº"
"å°åº¦å°åº¦ï¼Œæš‚åœä¹¦æˆ¿æ‰«åœ°æœºå™¨äºº"

# å°çˆ±åŒå­¦
"å°çˆ±åŒå­¦ï¼Œæ‰“å¼€å®¢å…æ‰«åœ°æœºå™¨äºº"
"å°çˆ±åŒå­¦ï¼Œå…³é—­å§å®¤æ‰«åœ°æœºå™¨äºº"
"å°çˆ±åŒå­¦ï¼Œæš‚åœä¹¦æˆ¿æ‰«åœ°æœºå™¨äºº"
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•è·å–å¹³å°çš„ client_id å’Œ client_secretï¼Ÿ

A: éœ€è¦åœ¨å„å¹³å°çš„å¼€æ”¾å¹³å°æ³¨å†Œå¼€å‘è€…è´¦å·ï¼Œåˆ›å»ºæŠ€èƒ½åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæˆ–å…è®¸ä½ è‡ªå®šä¹‰ã€‚

### Q2: redirect_uri å¿…é¡»æ˜¯ HTTPS å—ï¼Ÿ

A: æ˜¯çš„ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPSã€‚æœ¬åœ°æµ‹è¯•å¯ä»¥ä½¿ç”¨ HTTPã€‚

### Q3: å¦‚ä½•æµ‹è¯• OAuth æµç¨‹ï¼Ÿ

A: å¯ä»¥ä½¿ç”¨ Postman æˆ–æµè§ˆå™¨è®¿é—®æˆæƒé¡µé¢ï¼Œå®Œæˆæˆæƒåè·å– tokenã€‚

### Q4: è®¾å¤‡å‘ç°å¤±è´¥æ€ä¹ˆåŠï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. OAuth æˆæƒæ˜¯å¦æˆåŠŸ
2. Token æ˜¯å¦æœ‰æ•ˆ
3. æ•°æ®åº“ä¸­æ˜¯å¦æœ‰è®¾å¤‡æ•°æ®
4. æœåŠ¡åœ°å€é…ç½®æ˜¯å¦æ­£ç¡®

### Q5: å¦‚ä½•æ·»åŠ æ›´å¤šæµ‹è¯•è®¾å¤‡ï¼Ÿ

A: å‚è€ƒ test-data.sql ä¸­çš„è®¾å¤‡æ’å…¥è¯­å¥ï¼Œä¿®æ”¹è®¾å¤‡ IDã€åç§°ç­‰ä¿¡æ¯åæ‰§è¡Œã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
- [README.md](README.md) - é¡¹ç›®è¯´æ˜
- [ä½¿ç”¨è¯´æ˜.md](ä½¿ç”¨è¯´æ˜.md) - ä½¿ç”¨æŒ‡å—
- [API.md](API.md) - API æ–‡æ¡£
- å„å¹³å°å¼€æ”¾å¹³å°æ–‡æ¡£

---

**æœ€åæ›´æ–°**ï¼š2026-02-24
